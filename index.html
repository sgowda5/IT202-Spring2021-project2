<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <title>IT202-Project-2</title>
    <style>
    canvas {
      position: absolute;
      background-color: "white";
      height: 100vh;
      width: 100vw;
    }
    body {
      background-color: "white";
      margin: 0;
      padding: 0;
    }
    </style>
  </head>

  <body>
    
    <canvas id="canvas">
    </canvas>
 
    <script>

      let canvas = document.querySelector("canvas");
      let context = canvas.getContext("2d");
      let w= canvas.width;
      let h= canvas.height;

      const mousePic = new Image();
      mousePic.src = 'images/mouse.svg';
      // player
      let mouse = {x:(w/2)-80, y:(h/2), icon:mousePic,speed:15, score:0, health:10, rad:10};

      const catPic = new Image();
      catPic.src = 'images/cat.svg';

      let totalCats = 3;
      let cats = [];

      let x = w - 30;
      for (let i = 0; i < totalCats; i++) {
        let y = 15 + (Math.random() * (h - (30)));
        cats.push({x:x, y:y, speed:2, icon:catPic, rad:10});
      }

            const cheesePic = new Image();
      cheesePic.src = 'images/cheese.svg';

      let totalCheese = 3;
      let cheese = [];

      for (let i = 0; i < totalCheese; i++) {
        let y = 15 + (Math.random() * (h - (30)));
        cheese.push({x:x, y:y, speed:2, icon:cheesePic, rad:10});
      }

      const background = new Image();
      background.src = 'images/background.jpg';
      let startGame = false;

      document.addEventListener("DOMContentLoaded", (event) => {
         let areColliding = (c1, c2) => {
          let dy = c1.y - c2.y;
          let dx = c1.x - c2.x;
          let dist = Math.sqrt(dx*dx + dy*dy);
          if (dist < (c1.rad + c2.rad)) {
            return true;
          }
          return false;
        }
        function gameMaker() {
          context.clearRect(0, 0, w, h);

          context.drawImage(background, 0, 0, w, h);
          context.font = "bold 10px Verdana";
          context.fillStyle = "black";
          context.beginPath();
          context.arc(mouse.x, mouse.y, mouse.rad, 0, 2*Math.PI);
          context.fillStyle = "black";
          context.closePath();
          context.fill();
          context.drawImage(mouse.icon, (mouse.x - 10), (mouse.y - 12), 20, 20);

          if ((mouse.y + mouse.rad) > h) {
            mouse.y = h - mouse.rad;
          } else if ((mouse.y - mouse.rad) < 0) {
            mouse.y = mouse.rad;
          }

          cats.forEach((cat) => {
            context.beginPath();
            context.arc(cat.x, cat.y, cat.rad, 0, 2*Math.PI);
            context.fillStyle = "crimson";
            context.closePath();
            context.fill();
            context.drawImage(cat.icon, (cat.x - 10), (cat.y - 10), 20, 20);
            cat.x -= cat.speed;
          });

          let x = (w);
            cats.forEach( (cat) => {
              if (areColliding(mouse, cat)) {
                mouse.health--;
                cat.x = x;
                cat.y = cat.y = cat.rad + (Math.random()*(h - (2*cat.rad)));
              }
              if ((cat.x - cat.rad) < 0) {
                cat.x = x;
                cat.y = cat.rad + (Math.random()*(h - (2*cat.rad)));
              }
            });

          cheese.forEach((c) => {
              context.beginPath();
              context.arc(c.x, c.y, c.rad, 0, 2*Math.PI);
              context.closePath();
              context.drawImage(c.icon, (c.x - 10), (c.y - 12), 20, 20);
              c.x -= c.speed;
            });
          requestAnimationFrame(gameMaker);
        }
        requestAnimationFrame(gameMaker);
      });

      document.addEventListener("keydown", (event) => {
        if (event.keyCode == 38) {
          mouse.y -= mouse.speed;
        } else if (event.keyCode == 40) {
          mouse.y += mouse.speed;          
        }
      });
    </script>

  </body>
</html>