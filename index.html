<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <title>IT202-Project-2</title>
    <link rel="manifest" href="manifest.json" />
    <style>
    canvas {
      position: absolute;
      background-color: "white";
      height: 100vh;
      width: 100vw;
    }
    body {
      background-color: "black";
      margin: 0;
      padding: 0;
    }
    </style>
  </head>

  <body>
    
    <canvas id="canvas">
    </canvas>
     <script>

      let canvas = document.querySelector("canvas");
      let ctx = canvas.getContext("2d");
      let w= canvas.width;
      let h= canvas.height;
      const mousePic = new Image();
      mousePic.src = 'images/mouse.svg';
      let mouse = {x:(w/2)-80, y:(h/2), icon:mousePic,speed:15, score:0, health:10, rad:10};
      const catPic = new Image();
      catPic.src = 'images/cat.svg';
      let totalCats = 3;
      let cats = [];
let currentLevel = 1;
      let levels = [300, 270, 240, 210, 180, 150, 120, 90, 60, 30];
      let x = w - 30;
      for (let i = 0; i < totalCats; i++) {
        let y = 15 + (Math.random() * (h - (30)));
        cats.push({x:x, y:y, speed:2, icon:catPic, rad:10});
      }
           const cheesePic = new Image();
      cheesePic.src = 'images/cheese.svg';
  let totalCheese = 3;
  let cheese = [];
  for (let i = 0; i < totalCheese; i++) {
  let y = 15 + (Math.random() * (h - (30)));
  cheese.push({x:x, y:y, speed:2, icon:cheesePic, rad:10});
  }
  const background = new Image();
  background.src = 'images/background.jpg';
  let startGame = false;
  document.addEventListener("DOMContentLoaded", (event) => {
     let areColliding = (c1, c2) => {
      let dy = c1.y-c2.y;
          let dx = c1.x-c2.x;
          let dist = Math.sqrt(dx*dx+dy*dy);
          if (dist<(c1.rad+c2.rad)) {
            return true;
          }
          return false;
        }

        function gameMaker() {
          ctx.clearRect(0, 0, w, h);
          if (!startGame == true) {
              ctx.font = "bold 25px Verdana";
              ctx.fillStyle = "black";
              ctx.fillText("Welcome", w/2-80, h/2-50);
              ctx.font = "bold 10px Verdana";
              ctx.fillText("Press Up arrow to go up", w/2-70, h/2-30 );
              ctx.fillText("Press Down arrow to go down", w/2-70, h/2-15);
              ctx.fillText("Esacpe the cats or they will eat you", w/2-70, h/2);
              ctx.fillText("Collect the cheese so you can eat it", w/2-70, h/2+15);
              ctx.fillText("Press Space to Start", w/2 - 70, h/2 + 40);
              requestAnimationFrame(gameMaker);
          } else {
            ctx.drawImage(background, 0, 0, w, h);
            ctx.font = "bold 10px Verdana";
            ctx.fillStyle = "black";
            ctx.fillText("Score : "+mouse.score+" Health : "+mouse.health+" Level : "+currentLevel, 20, 10);
            ctx.beginPath();
            ctx.arc(mouse.x, mouse.y, mouse.rad, 0, 2*Math.PI);
            ctx.fillStyle = "black";
            ctx.closePath();
            ctx.fill();
            ctx.drawImage(mouse.icon, (mouse.x - 10), (mouse.y - 12), 20, 20);
          if ((mouse.y+mouse.rad)>h) {
            mouse.y = h-mouse.rad;
          } else if ((mouse.y-mouse.rad) < 0) {
            mouse.y = mouse.rad;
          }
          cats.forEach((cat) => {
            ctx.beginPath();
            ctx.arc(cat.x, cat.y, cat.rad, 0, 2*Math.PI);
            ctx.fillStyle = "crimson";
            ctx.closePath();
            ctx.fill();
            ctx.drawImage(cat.icon, (cat.x - 10), (cat.y - 10), 20, 20);
            cat.x -= cat.speed;
          });

          let x = (w);
            cats.forEach( (cat) => {
              if (areColliding(mouse, cat)) {
                mouse.health--;
                cat.x = x;
                cat.y = 10+(Math.random()*(h-(20)));
              }
              if ((cat.x-cat.rad)<0) {
                cat.x = x;
                cat.y = 10+(Math.random()*(h-(20)));
              }
            });

          cheese.forEach((c) => {
              ctx.beginPath();
              ctx.arc(c.x, c.y, c.rad, 0, 2*Math.PI);
              ctx.closePath();
              ctx.drawImage(c.icon, (c.x-10), (c.y-12), 20, 20);
              c.x -= c.speed;
            });
             cheese.forEach( (c) => {
              if (areColliding(mouse, c)) {
                mouse.score++;
                c.x = x;
                c.y = 10+(Math.random()*(h-(20)));
              }
              if ((c.x - 10) < 0) {
                c.x = x;
                c.y = 10+(Math.random()*(h-(20)));
              }
            });

              for (let i = 0; i < 10; i++) {
              if (mouse.score == levels[i]) {
                currentLevel++;
                levels.pop();     
                let y = 15 + (Math.random() * (h - (30)));
                cats.push({x:x, y:y, speed:2, icon:catPic, rad:10});
                cats.forEach((cat) => {cat.speed++;});
              }
            }
          if (mouse.health <= 0) {
              ctx.font = "bold 20px Verdana";
              ctx.fillStyle = "black";
              ctx.fillText("Game Over", w/2 - 50, h/2);
            } else {
              requestAnimationFrame(gameMaker);
            }}
      }
        requestAnimationFrame(gameMaker);
      });
      document.addEventListener("keydown", (event) => {
        if (event.keyCode == 32) {
          startGame = true;
        } else if (event.keyCode == 40) {
          mouse.y += mouse.speed;          
        } else if (event.keyCode == 38) {
          mouse.y -= mouse.speed;
        }
      });
    </script>
    <script>
        if ('serviceWorker' in navigator) {
          window.addEventListener('load', function() {
            navigator.serviceWorker.register('./sw.js').then(function(registration) {
              console.log('ServiceWorker registration successful with scope: ', registration.scope);
            }, function(err) {
              console.log('ServiceWorker registration failed: ', err);
            });
          });
        }
    </script>
  </body>
</html>